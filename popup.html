<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Meeting Transcription Assistant</title>
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <div class="container">
    <header class="main-header">
      <div class="header-content">
        <h1>Meeting Transcription Assistant</h1>
        <div class="status-bar">
          <span>Status: </span>
          <span id="status" class="status-text">Ready</span>
        </div>
      </div>
      <div class="header-actions">
        <button id="endpointSettingsBtn" class="btn btn-icon" title="API Configuration">üîó</button>
        <button id="settingsBtn" class="btn btn-icon" title="Model & Feature Settings">‚öôÔ∏è</button>
        <button id="showHistoryBtn" class="btn btn-icon" title="History">üìã</button>
      </div>
    </header>
    
    <div class="control-panel">
      <div class="control-row">
        <div class="team-section">
          <select id="teamSelect" class="select-field-compact">
            <option value="" disabled selected>Select Session</option>
          </select>
          <button id="addTeamBtn" class="btn btn-icon-small" title="New Session">+</button>
          <button id="deleteTeamBtn" class="btn btn-icon-small btn-danger" title="Delete Session" disabled>üóëÔ∏è</button>
          <button id="bulkDeleteBtn" class="btn btn-icon-small btn-danger" title="Bulk Delete Sessions" disabled>üìã</button>
        </div>
        
        <div class="recording-section">
          <button id="startBtn" class="btn btn-primary-compact">Start Recording</button>
          <button id="stopBtn" class="btn btn-danger-compact" disabled>Stop Recording</button>
        </div>
        
        <div class="language-section">
          <label for="languageSelect" class="label-compact">Language:</label>
          <select id="languageSelect" class="select-field-compact">
            <option value="">Auto</option>
            <option value="en">English</option>
            <option value="zh">Chinese</option>
            <option value="ja">Japanese</option>
          </select>
        </div>
      </div>
    </div>
    
    <!-- Endpoint Settings Panel -->
    <div id="endpointSettingsPanel" class="settings-panel hidden">
      <h2>API Configuration</h2>
      <div class="setting-group">
        <label for="apiEndpointInput">Base API URL:</label>
        <input type="text" id="apiEndpointInput" class="input-field" 
               placeholder="https://api.openai.com/v1" value="https://api.openai.com/v1">
        <div class="setting-description">OpenAI-compatible API endpoint (e.g., https://api.openai.com/v1)</div>
      </div>
      <div class="setting-group">
        <label for="apiKeyInput">Primary API Key:</label>
        <input type="password" id="apiKeyInput" class="input-field" 
               placeholder="sk-..." autocomplete="off">
        <div class="setting-description">API key for chat completions and image analysis</div>
      </div>
      <div class="setting-group">
        <label for="sttProviderSelect">STT Provider:</label>
        <select id="sttProviderSelect" class="input-field">
          <option value="openai">OpenAI (Default)</option>
          <option value="trendmicro">Trend Micro AI Endpoint</option>
          <option value="groq">Groq (Fast & Cheap)</option>
          <option value="custom">Custom Endpoint</option>
        </select>
        <div class="setting-description">Speech-to-Text service provider</div>
      </div>
      <div class="setting-group" id="customEndpointGroup" style="display: none;">
        <label for="sttApiEndpointInput">STT Endpoint URL:</label>
        <input type="text" id="sttApiEndpointInput" class="input-field" 
               placeholder="https://your-api.com/v1" value="">
        <div class="setting-description">Custom endpoint for speech-to-text API</div>
      </div>
      <div class="setting-group">
        <label for="sttApiKeyInput">STT API Key:</label>
        <input type="password" id="sttApiKeyInput" class="input-field" 
               placeholder="Leave empty to use primary API key" autocomplete="off">
        <div class="setting-description">Optional: Dedicated API key for transcription. If empty, uses the primary API key</div>
      </div>
      <div class="setting-group">
        <label for="sttModelSelect">Transcription Model:</label>
        <select id="sttModelSelect" class="input-field">
          <option value="">Select a model...</option>
        </select>
        <div id="modelDescription" class="setting-description" style="margin-top: 5px;"></div>
      </div>
      <div class="setting-group" id="customModelGroup" style="display: none;">
        <label for="sttModelInput">Model ID:</label>
        <input type="text" id="sttModelInput" class="input-field" 
               placeholder="Enter model identifier" value="">
        <div class="setting-description">Custom model name/ID for transcription</div>
      </div>
      <div class="setting-group">
        <button id="saveEndpointSettingsBtn" class="btn btn-primary">Save API Configuration</button>
      </div>
    </div>
    
    <div id="settingsPanel" class="settings-panel hidden">
      <h2>Model & Feature Settings</h2>
      <div class="setting-group">
        <h3>Meeting Note Helper Models</h3>
        <div class="model-configurations">
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel1" checked>
              <span>Model 1:</span>
            </label>
            <select id="modelSelect1" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel2">
              <span>Model 2:</span>
            </label>
            <select id="modelSelect2" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel3">
              <span>Model 3:</span>
            </label>
            <select id="modelSelect3" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel4">
              <span>Model 4:</span>
            </label>
            <select id="modelSelect4" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
        </div>
      </div>
      <div class="setting-group">
        <label for="screenshotModelSelect">Screenshot Summary Model (Image to Text):</label>
        <select id="screenshotModelSelect" class="input-field">
          <option value="">Please test connection first</option>
        </select>
      </div>
      <div class="setting-group">
        <label for="screenshotDetailSelect">Screenshot Analysis Detail:</label>
        <select id="screenshotDetailSelect" class="input-field">
          <option value="low">Low - Brief summary</option>
          <option value="medium" selected>Medium - Concise summary (Default)</option>
          <option value="high">High - Detailed analysis</option>
        </select>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="enableScreenshotAnalysis" checked> Enable Screenshot Analysis
        </label>
        <div class="setting-description">Capture and analyze screenshots periodically during recording</div>
      </div>
      <div class="setting-group">
        <label for="screenshotIntervalInput">Screenshot Capture Interval (seconds):</label>
        <input type="number" id="screenshotIntervalInput" class="input-field" 
               min="5" max="300" value="20" step="5">
        <div class="setting-description">How often to capture and analyze screenshots (5-300 seconds)</div>
      </div>
      <div class="setting-group">
        <label for="transcriptionIntervalInput">Transcription Interval (seconds):</label>
        <input type="number" id="transcriptionIntervalInput" class="input-field" 
               min="5" max="60" value="10" step="5">
        <div class="setting-description">How often to process audio for transcription (5-60 seconds)</div>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="enableAudioRerouting" checked> Enable Audio Rerouting
        </label>
        <div class="setting-description">Keep tab audio playing through speakers while recording (prevents audio from being muted during capture)</div>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="downloadFilesCheckbox"> Download Audio Files
        </label>
        <div class="setting-description">When enabled, 10-second audio segments will be saved to Downloads/audio_capture folder</div>
      </div>
      
      <div class="setting-group">
        <h3>Meeting Note Helper - Prompt Templates</h3>
        <div class="prompt-settings">
          <div class="template-selector">
            <label for="promptTemplateSelect">Select Template:</label>
            <div style="display: flex; gap: 10px; margin-bottom: 10px;">
              <select id="promptTemplateSelect" class="input-field" style="flex: 1;">
                <option value="">-- Select a template --</option>
              </select>
              <button id="newTemplateBtn" class="btn btn-sm btn-secondary" title="New Template">+</button>
              <button id="deleteTemplateBtn" class="btn btn-sm btn-danger" title="Delete Template" disabled>üóëÔ∏è</button>
            </div>
          </div>
          
          <div class="template-editor" id="templateEditor" style="display: none;">
            <label for="templateName">Template Name:</label>
            <input type="text" id="templateName" class="input-field" placeholder="Enter template name" style="margin-bottom: 10px;">
            
            <label for="userPromptTemplate">Prompt Template:</label>
            <div class="setting-description">
              Use <code>{context}</code> as a placeholder for meeting transcripts and screenshot analysis
            </div>
            <textarea id="userPromptTemplate" class="user-prompt-template" 
                      placeholder="Enter your custom prompt template here. Use {context} where you want the meeting content to be inserted."
                      style="min-height: 150px;">
            </textarea>
            
            <div style="margin-top: 10px;">
              <button id="saveTemplateBtn" class="btn btn-sm btn-primary">Save Template</button>
              <button id="cancelTemplateBtn" class="btn btn-sm btn-secondary">Cancel</button>
            </div>
          </div>
          
          <div class="prompt-examples" style="margin-top: 15px;">
            <small>
              <strong>Example templates:</strong><br>
              ‚Ä¢ Meeting Summary: "Please summarize the key points and action items from: {context}"<br>
              ‚Ä¢ Technical Review: "Analyze the technical discussion and provide recommendations from: {context}"<br>
              ‚Ä¢ Project Status: "Extract project updates and next steps from: {context}"
            </small>
          </div>
        </div>
      </div>
      
      <div class="setting-group">
        <div class="save-settings-row">
          <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
        </div>
        <div class="test-buttons-row">
          <button id="testConnectionBtn" class="btn btn-secondary">Test Connection</button>
          <button id="testScreenshotBtn" class="btn btn-secondary">Test Screenshot</button>
          <button id="testAudioBtn" class="btn btn-secondary">Test Audio</button>
        </div>
      </div>
    </div>
    
    <!-- Bulk Delete Panel -->
    <div id="bulkDeletePanel" class="bulk-delete-panel hidden">
      <h3>Select Sessions to Delete</h3>
      <div class="bulk-actions">
        <button id="selectAllBtn" class="btn btn-sm">Select All</button>
        <button id="deselectAllBtn" class="btn btn-sm">Deselect All</button>
      </div>
      <div id="teamListForDelete" class="team-list-delete">
        <!-- Session checkboxes will be dynamically filled here -->
      </div>
      <div class="bulk-actions-bottom">
        <button id="cancelBulkDeleteBtn" class="btn btn-secondary">Cancel</button>
        <button id="confirmBulkDeleteBtn" class="btn btn-danger" disabled>Delete Selected</button>
      </div>
    </div>
    
    <!-- Meeting History Panel -->
    <div id="historyPanel" class="history-panel hidden">
      <h2>Recording History</h2>
      <div class="history-controls">
        <select id="historyTeamSelect" class="select-field">
          <option value="">All Sessions</option>
        </select>
        <button id="refreshHistoryBtn" class="btn btn-secondary btn-sm">Refresh</button>
      </div>
      <div id="historyContainer" class="history-container">
        <!-- Meeting history will be dynamically filled here -->
      </div>
    </div>
    
    <div class="transcript-panel">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <h2>Live Transcription</h2>
        <button id="runAnalysisBtn" class="btn btn-secondary btn-sm" style="display: none;">Run AI Analysis</button>
      </div>
      <div id="transcriptContainer" class="transcript-container"></div>
    </div>
  </div>
  
  <script src="scripts/securityUtils.js"></script>
  <script src="scripts/apiService.js"></script>
  <script src="scripts/popup.js"></script>
</body>
</html>