<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teams Meeting Assistant</title>
  <link rel="stylesheet" href="styles/popup.css">
</head>
<body>
  <div class="container">
    <header class="main-header">
      <div class="header-content">
        <h1>Teams Meeting Assistant</h1>
        <div class="status-bar">
          <span>Status: </span>
          <span id="status" class="status-text">Ready</span>
        </div>
      </div>
      <div class="header-actions">
        <button id="settingsBtn" class="btn btn-icon">‚öôÔ∏è</button>
        <button id="showHistoryBtn" class="btn btn-icon">üìã</button>
      </div>
    </header>
    
    <div class="control-panel">
      <div class="control-row">
        <div class="team-section">
          <select id="teamSelect" class="select-field-compact">
            <option value="" disabled selected>Select Team</option>
          </select>
          <button id="addTeamBtn" class="btn btn-icon-small" title="Add Team">+</button>
          <button id="deleteTeamBtn" class="btn btn-icon-small btn-danger" title="Delete Team" disabled>üóëÔ∏è</button>
          <button id="bulkDeleteBtn" class="btn btn-icon-small btn-danger" title="Bulk Delete Teams" disabled>üìã</button>
        </div>
        
        <div class="recording-section">
          <button id="startBtn" class="btn btn-primary-compact">Start Recording</button>
          <button id="stopBtn" class="btn btn-danger-compact" disabled>Stop Recording</button>
        </div>
        
        <div class="language-section">
          <label for="languageSelect" class="label-compact">Language:</label>
          <select id="languageSelect" class="select-field-compact">
            <option value="">Auto</option>
            <option value="en">English</option>
            <option value="zh">‰∏≠Êñá</option>
            <option value="ja">Êó•Êú¨Ë™û</option>
          </select>
        </div>
      </div>
    </div>
    
    <div id="settingsPanel" class="settings-panel hidden">
      <div class="setting-group">
        <label for="apiEndpointInput">API Endpoint:</label>
        <input type="text" id="apiEndpointInput" class="input-field" 
               placeholder="https://api.openai.com/v1" value="https://api.openai.com/v1">
      </div>
      <div class="setting-group">
        <label for="apiKeyInput">OpenAI API Key:</label>
        <input type="password" id="apiKeyInput" class="input-field" 
               placeholder="sk-..." autocomplete="off">
      </div>
      <div class="setting-group">
        <label for="sttApiEndpointInput">API Endpoint (For Speech to Text):</label>
        <input type="text" id="sttApiEndpointInput" class="input-field" 
               placeholder="https://api.openai.com/v1 (Default: OpenAI)" value="">
        <div class="setting-description">Leave empty to use default OpenAI endpoint for speech-to-text transcription</div>
      </div>
      <div class="setting-group">
        <label for="sttApiKeyInput">API Key (For Speech to Text):</label>
        <input type="password" id="sttApiKeyInput" class="input-field" 
               placeholder="Leave empty to use main API key" autocomplete="off">
        <div class="setting-description">Optional: Separate API key for speech-to-text. If empty, will use the main API key above</div>
      </div>
      <div class="setting-group">
        <label for="sttModelInput">Speech-to-Text Model:</label>
        <input type="text" id="sttModelInput" class="input-field" 
               placeholder="whisper-1 (Default)" value="">
        <div class="setting-description">
          <strong>OpenAI Models:</strong><br>
          ‚Ä¢ whisper-1 (Default, stable)<br>
          ‚Ä¢ gpt-4o-mini-transcribe (Faster, cheaper)<br>
          ‚Ä¢ gpt-4o-transcribe (Most accurate)<br>
          <strong>Self-hosted:</strong> whisper-tiny, whisper-base, whisper-small, whisper-medium, whisper-large, whisper-large-v2, whisper-large-v3
        </div>
      </div>
      <div class="setting-group">
        <h3>Meeting Note Helper Models</h3>
        <div class="model-configurations">
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel1" checked>
              <span>Model 1:</span>
            </label>
            <select id="modelSelect1" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel2">
              <span>Model 2:</span>
            </label>
            <select id="modelSelect2" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel3">
              <span>Model 3:</span>
            </label>
            <select id="modelSelect3" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
          <div class="model-config-item">
            <label class="checkbox-label">
              <input type="checkbox" id="enableModel4">
              <span>Model 4:</span>
            </label>
            <select id="modelSelect4" class="input-field model-select">
              <option value="">Please test connection first</option>
            </select>
          </div>
        </div>
      </div>
      <div class="setting-group">
        <label for="screenshotModelSelect">Screenshot Summary Model (Image to Text):</label>
        <select id="screenshotModelSelect" class="input-field">
          <option value="">Please test connection first</option>
        </select>
      </div>
      <div class="setting-group">
        <label for="screenshotDetailSelect">Screenshot Analysis Detail:</label>
        <select id="screenshotDetailSelect" class="input-field">
          <option value="low">Low - Brief summary</option>
          <option value="medium" selected>Medium - Concise summary (Default)</option>
          <option value="high">High - Detailed analysis</option>
        </select>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="enableScreenshotAnalysis" checked> Enable Screenshot Analysis
        </label>
        <div class="setting-description">Capture and analyze screenshots periodically during recording</div>
      </div>
      <div class="setting-group">
        <label for="screenshotIntervalInput">Screenshot Capture Interval (seconds):</label>
        <input type="number" id="screenshotIntervalInput" class="input-field" 
               min="5" max="300" value="10" step="5">
        <div class="setting-description">How often to capture and analyze screenshots (5-300 seconds)</div>
      </div>
      <div class="setting-group">
        <label for="transcriptionIntervalInput">Transcription Interval (seconds):</label>
        <input type="number" id="transcriptionIntervalInput" class="input-field" 
               min="5" max="60" value="10" step="5">
        <div class="setting-description">How often to process audio for transcription (5-60 seconds)</div>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="enableAudioRerouting" checked> Enable Audio Rerouting
        </label>
        <div class="setting-description">Keep tab audio playing through speakers while recording (prevents audio from being muted during capture)</div>
      </div>
      <div class="setting-group">
        <label class="checkbox-label">
          <input type="checkbox" id="downloadFilesCheckbox"> ‰∏ãËºâÈü≥Ë®äÊ™îÊ°à (audio_captureË≥áÊñôÂ§æ)
        </label>
        <div class="setting-description">Ëã•ÂïüÁî®ÔºåÊØè10ÁßíÁöÑÈåÑÈü≥Â∞á‰øùÂ≠òÂà∞Downloads/audio_captureË≥áÊñôÂ§æ</div>
      </div>
      
      <div class="setting-group">
        <h3>Meeting Note Helper Settings</h3>
        <div class="prompt-settings">
          <label for="userPromptTemplate">User Prompt Template:</label>
          <div class="setting-description">
            Use <code>{context}</code> as a placeholder for meeting transcripts and screenshot analysis
          </div>
          <textarea id="userPromptTemplate" class="user-prompt-template" 
                    placeholder="Enter your custom prompt template here. Use {context} where you want the meeting content to be inserted.">
          </textarea>
          <div class="prompt-examples">
            <small>
              <strong>Example templates:</strong><br>
              ‚Ä¢ Meeting Summary: "Please summarize the key points and action items from: {context}"<br>
              ‚Ä¢ Technical Review: "Analyze the technical discussion and provide recommendations from: {context}"<br>
              ‚Ä¢ Project Status: "Extract project updates and next steps from: {context}"
            </small>
          </div>
        </div>
      </div>
      
      <div class="setting-group">
        <div class="save-settings-row">
          <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>
        </div>
        <div class="test-buttons-row">
          <button id="testConnectionBtn" class="btn btn-secondary">Test Connection</button>
          <button id="testScreenshotBtn" class="btn btn-secondary">Test Screenshot</button>
          <button id="testAudioBtn" class="btn btn-secondary">Test Audio</button>
        </div>
      </div>
    </div>
    
    <!-- Bulk Delete Panel -->
    <div id="bulkDeletePanel" class="bulk-delete-panel hidden">
      <h3>Select Teams to Delete</h3>
      <div class="bulk-actions">
        <button id="selectAllBtn" class="btn btn-sm">Select All</button>
        <button id="deselectAllBtn" class="btn btn-sm">Deselect All</button>
      </div>
      <div id="teamListForDelete" class="team-list-delete">
        <!-- Team checkboxes will be dynamically filled here -->
      </div>
      <div class="bulk-actions-bottom">
        <button id="cancelBulkDeleteBtn" class="btn btn-secondary">Cancel</button>
        <button id="confirmBulkDeleteBtn" class="btn btn-danger" disabled>Delete Selected</button>
      </div>
    </div>
    
    <!-- Meeting History Panel -->
    <div id="historyPanel" class="history-panel hidden">
      <h2>Meeting History</h2>
      <div class="history-controls">
        <select id="historyTeamSelect" class="select-field">
          <option value="">All Teams</option>
        </select>
        <button id="refreshHistoryBtn" class="btn btn-secondary btn-sm">Refresh</button>
      </div>
      <div id="historyContainer" class="history-container">
        <!-- Meeting history will be dynamically filled here -->
      </div>
    </div>
    
    <div class="transcript-panel">
      <h2>Live Transcription</h2>
      <div id="transcriptContainer" class="transcript-container"></div>
    </div>
  </div>
  
  <script src="scripts/apiService.js"></script>
  <script src="scripts/popup.js"></script>
</body>
</html>